{"version":3,"sources":["../../src/usecases/CountMinusByExpiryDate.js"],"names":["CountMinusByExpiryDate","today","Date","setHours","setMinutes","setSeconds","_today","zaico","quantity","toNum","undefined","limit","_optValue","Base","OPTION_NAMES","LIMIT","limitDate","LIMIT_DATE","_toDateOld","console","log","title","id","code","d","_optSet","_formatDate","_setTitleDate"],"mappings":";;;;;;;;AAAA;;;;;;;;;;;;IAEqBA,sB;;;AAEnB,oCAAc;AAAA;;AAAA;;AAEZ,QAAMC,QAAQ,IAAIC,IAAJ,EAAd;AACAD,UAAME,QAAN,CAAe,CAAf;AACAF,UAAMG,UAAN,CAAiB,CAAjB;AACAH,UAAMI,UAAN,CAAiB,CAAjB;AACA,UAAKC,MAAL,GAAcL,KAAd;AANY;AAOb;;;;kCAEa;AACZ;AAOD;;;6BAEQM,K,EAAO;AACd;AACA,UAAMC,WAAW,KAAKC,KAAL,CAAWF,MAAMC,QAAjB,CAAjB;AACA,UAAIA,aAAaE,SAAjB,EAA4B;AAC1B,eAAO,KAAP,CAD0B,CACZ;AACf;AACD,UAAMC,QAAQ,KAAKC,SAAL,CAAeL,KAAf,EAAsBM,eAAKC,YAAL,CAAkBC,KAAxC,CAAd;AACA,UAAMC,YAAY,KAAKJ,SAAL,CAAeL,KAAf,EAAsBM,eAAKC,YAAL,CAAkBG,UAAxC,CAAlB;AACA,UAAID,aAAa,CAACL,KAAlB,EAAyB,OAAO,KAAP;AACzB,UAAI,CAAC,KAAKO,UAAL,CAAgBP,KAAhB,CAAL,EAA6B;AAC3BQ,gBAAQC,GAAR,OAAgBb,MAAMc,KAAtB,6CAA+Cd,MAAMe,EAArD,eAAiEf,MAAMgB,IAAvE,QAD2B,CACsD;AACjF,eAAO,KAAP;AACD;AACD,aAAO,IAAP;AACD;;;4BAEOhB,K,EAAO;AACb,UAAMiB,IAAI,KAAKN,UAAL,CAAgB,KAAKN,SAAL,CAAeL,KAAf,EAAsBM,eAAKC,YAAL,CAAkBC,KAAxC,CAAhB,CAAV;AACA,WAAKU,OAAL,CAAalB,KAAb,EAAoBM,eAAKC,YAAL,CAAkBG,UAAtC,EAAkD,KAAKS,WAAL,CAAiBF,CAAjB,CAAlD;AACA;AACA,UAAIA,IAAI,KAAKlB,MAAb,EAAqB;AACnBC,cAAMC,QAAN,GAAiB,KAAjB,CADmB,CACK;AACxB,aAAKmB,aAAL,CAAmBpB,KAAnB;AACD,OAHD,MAGO;AACL,aAAKoB,aAAL,CAAmBpB,KAAnB,EAA0BiB,CAA1B;AACD;AACD,aAAOjB,KAAP;AACD;;;;EAhDiDM,c;;kBAA/Bb,sB","file":"CountMinusByExpiryDate.js","sourcesContent":["import Base from './Base';\n\nexport default class CountMinusByExpiryDate extends Base {\n\n  constructor() {\n    super();\n    const today = new Date();\n    today.setHours(0);\n    today.setMinutes(0);\n    today.setSeconds(0);\n    this._today = today;\n  }\n\n  description() {\n    return `\\\n【CountMinusByExpiryDate】\n★「賞味（消費）期限（日付型）」が空で「賞味期限（消費）」が入っている場合\n(1) 日付を日付型にコピーする(「賞味期限（消費）」=>「賞味（消費）期限（日付型）」)\n(2) 期限が過去であれば数値を０にし、タイトルから削除する\n(3) 日付フォーマットがおかしい場合(8桁数値ではない、日付値としてありえないなど)の場合にはエラーを出す\n`;\n  }\n\n  isTarget(zaico) {\n    // 数量\n    const quantity = this.toNum(zaico.quantity);\n    if (quantity === undefined) {\n      return false; // 初期導入データなのでスキップ\n    }\n    const limit = this._optValue(zaico, Base.OPTION_NAMES.LIMIT);\n    const limitDate = this._optValue(zaico, Base.OPTION_NAMES.LIMIT_DATE);\n    if (limitDate || !limit) return false;\n    if (!this._toDateOld(limit)) {\n      console.log(`[${zaico.title}] 日付不正(skip) [id:${zaico.id}, code:${zaico.code}]`); // (3)\n      return false;\n    }\n    return true;\n  }\n\n  editOne(zaico) {\n    const d = this._toDateOld(this._optValue(zaico, Base.OPTION_NAMES.LIMIT))\n    this._optSet(zaico, Base.OPTION_NAMES.LIMIT_DATE, this._formatDate(d));\n    // this._optSet(zaico, Base.OPTION_NAMES.LIMIT, '');\n    if (d < this._today) {\n      zaico.quantity = '0.0'; // (2)\n      this._setTitleDate(zaico);\n    } else {\n      this._setTitleDate(zaico, d);\n    }\n    return zaico;\n  }\n}\n"]}