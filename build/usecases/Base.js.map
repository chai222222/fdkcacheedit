{"version":3,"sources":["../../src/usecases/Base.js"],"names":["Base","Promise","resolve","val","undefined","length","parseInt","e","str","test","zaico","title","res","exec","_isLimitStr","limitIndex","_optIndex","OPTION_NAMES","LIMIT","optional_attributes","value","limit","m","match","targetName","Array","isArray","findIndex","name","idx","push","dt","nTitle","replace","_formatDate","dtStr","trim","dstr","fmtIsDate","Date","parse","getFullYear","getMonth","slice","getDate","join","LIMIT_DATE","KEYWORD","PLACE_OF_FOODDRIVE"],"mappings":"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","file":"Base.js","sourcesContent":["import fs from 'fs';\nimport path from 'path';\n\nexport default class Base {\n\n  static OPTION_NAMES = {\n    LIMIT: '賞味期限（消費）',\n    LIMIT_DATE: '賞味（消費）期限（日付型）',\n    KEYWORD: 'キーワード',\n    PLACE_OF_FOODDRIVE: 'フードドライブ場所',\n  }\n\n  description() {\n  }\n\n  isTarget() {\n    return false;\n  }\n\n  editOne() {\n  }\n\n  preEdit() {\n    return Promise.resolve();\n  }\n\n  toNum(val) {\n    if (typeof val === 'number') return val;\n    if (typeof val !== 'string') {\n      return undefined;\n    }\n    if (val.length === 0) return 0;\n    try {\n      return parseInt(val, 10);\n    } catch (e) {\n      return undefined;\n    }\n  }\n\n  _isLimitStr(str) {\n    return str && /^\\d+年\\d+月|^\\d{4}\\/\\d{2}\\/\\d{2}\\D?|^\\d{8}\\D?|^期限なし$/.test(str);\n  }\n\n  _isLimitIntTitle(zaico) {\n    if (typeof zaico.title !== 'string' || !zaico.title) return false;\n    const res = /^【([^】]+)】/.exec(zaico.title);\n    // if (res) console.log('******', res[0]);\n    return res && this._isLimitStr(res[1]);\n  }\n\n  _getLimit(zaico) {\n    const limitIndex = this._optIndex(zaico, Base.OPTION_NAMES.LIMIT);\n    return limitIndex >= 0 && zaico.optional_attributes[limitIndex].value || '';\n  }\n\n  _limitStr2CategoryStr(limit) {\n    let m = limit.match(/^(\\d+)年(\\d+)月/);\n    if (!m) m = limit.match(/^(\\d{4})(\\d{2})\\d{2}/);\n    if (!m) return limit;\n    return `${m[1]}年${m[2]}月`;\n  }\n\n  _optIndex(zaico, targetName) {\n    return Array.isArray(zaico.optional_attributes)\n      ? zaico.optional_attributes.findIndex(({name}) => name === targetName)\n      : -1;\n  }\n\n  _optValue(zaico, targetName) {\n    const idx = this._optIndex(zaico, targetName);\n    return idx < 0 ? undefined : zaico.optional_attributes[idx].value;\n  }\n\n  _optSet(zaico, targetName, value) {\n    if (Array.isArray(zaico.optional_attributes)) {\n      const idx = zaico.optional_attributes.findIndex(({name}) => name === targetName);\n      if (idx >= 0) {\n        zaico.optional_attributes[idx].value = value;\n        return;\n      }\n    } else {\n      zaico.optional_attributes = [];\n    }\n    zaico.optional_attributes.push({ name: targetName, value: value });\n  }\n\n  _setTitleDate(zaico, dt) {\n    const nTitle = zaico.title.replace(/^【[^】]+】 */, '');\n    zaico.title =  dt ? `【${this._formatDate(dt)}】${nTitle}` : nTitle;\n  }\n\n  _toDate(dtStr) {\n    const str = dtStr.trim();\n    let dstr;\n    const fmtIsDate = str.match(/^\\d{8}$/) && Date.parse(dstr = str.replace(/^(\\d{4})(\\d{2})/, '$1/$2/'));\n    return fmtIsDate && new Date(dstr);\n  }\n\n  _formatDate(dt) {\n    return [\n      dt.getFullYear(),\n      ('00' + (dt.getMonth()+1)).slice(-2),\n      ('00' + dt.getDate()).slice(-2)\n    ].join('/');\n  }\n}\n"]}